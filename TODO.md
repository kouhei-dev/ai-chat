# AIチャット - 実装計画 TODO

## フェーズ1: プロジェクト初期設定

- [ ] Next.jsプロジェクトの作成（App Router、TypeScript）
- [ ] ESLint + Prettierの設定
- [ ] Tailwind CSSの設定
- [ ] 基本ディレクトリ構成の作成
- [ ] 環境変数ファイル（.env.example）の作成
- [ ] .gitignoreの設定

## フェーズ2: データベース設定

- [ ] Prismaのインストールと初期設定
- [ ] MongoDB接続設定
- [ ] Prismaスキーマの定義（Session, Conversation, Message）
- [ ] Prismaクライアントの生成
- [ ] データベース接続ユーティリティの作成（src/lib/db/prisma.ts）
- [ ] データベース接続テストの実施
  - [ ] MongoDBへの接続確認
  - [ ] CRUD操作の動作確認（テストデータの作成・取得・削除）

## フェーズ3: バックエンド実装

### Hono設定
- [ ] Honoのインストール
- [ ] Next.js App Router上でのHonoルート設定（src/app/api/[[...route]]/route.ts）

### Mastra + Claude API設定
- [ ] Mastraのインストールと設定
- [ ] Claude-4-sonnet用のエージェント設定（src/lib/mastra/agent.ts）
- [ ] システムプロンプトの定義

### セッション管理
- [ ] セッションID生成ユーティリティの作成（UUIDv4）
- [ ] セッション有効期限の設定（環境変数から取得）
- [ ] POST /api/session エンドポイントの実装（セッション作成）
- [ ] GET /api/session/:sessionId エンドポイントの実装（セッション検証）
- [ ] 期限切れセッションのハンドリング

### APIエンドポイント
- [ ] POST /api/chat エンドポイントの実装
- [ ] リクエストバリデーション（セッションID検証を含む）
- [ ] 会話履歴のDB保存処理
- [ ] エラーハンドリング

## フェーズ4: フロントエンド実装

### レイアウト
- [ ] 共通レイアウトの作成（src/app/layout.tsx）
- [ ] メタデータ設定（タイトル、説明）
- [ ] フォント設定

### チャットUIコンポーネント
- [ ] ChatContainer.tsx - チャット全体のコンテナ
- [ ] MessageList.tsx - メッセージ一覧表示
- [ ] MessageItem.tsx - 個別メッセージ表示（ユーザー/AI区別）
- [ ] ChatInput.tsx - メッセージ入力フォーム

### 共通UIコンポーネント
- [ ] Button.tsx - ボタンコンポーネント
- [ ] Loading.tsx - ローディング表示

### ページ実装
- [ ] メインページ（src/app/page.tsx）
- [ ] APIクライアントの作成（src/lib/api/chat.ts）

### スタイリング
- [ ] ビジネスライクなカラースキームの定義
- [ ] レスポンシブ対応（モバイル・タブレット・デスクトップ）
- [ ] チャットバブルのスタイリング
- [ ] 入力フォームのスタイリング

## フェーズ5: 状態管理・UX改善

### セッション管理（フロントエンド）
- [ ] セッションIDのlocalStorage保存・取得
- [ ] 初回アクセス時のセッション作成処理
- [ ] セッション有効性チェック（ページ読み込み時）
- [ ] セッション期限切れ時の再作成処理

### 会話状態管理
- [ ] 会話状態の管理（useState/useReducer）
- [ ] ローディング状態の表示
- [ ] エラー状態の表示
- [ ] 送信中の入力無効化
- [ ] 自動スクロール（新メッセージ時）
- [ ] 入力フォームのEnterキー送信対応

## フェーズ6: テスト

### 単体テスト（Vitest）
- [ ] Vitestのインストールと設定
- [ ] セッション管理APIのテスト
  - [ ] セッション作成テスト
  - [ ] セッション検証テスト
  - [ ] 期限切れセッションのテスト
- [ ] チャットAPIエンドポイントのテスト
- [ ] ユーティリティ関数のテスト
- [ ] コンポーネントのテスト

### E2Eテスト（Playwright）
- [ ] Playwrightのインストールと設定
- [ ] セッション管理のテスト（初回アクセス、再訪問）
- [ ] 基本的なチャットフローのテスト
- [ ] レスポンシブ表示のテスト
- [ ] エラーケースのテスト

## フェーズ7: デプロイ準備

### Docker化
- [ ] Dockerfileの作成
- [ ] docker-compose.ymlの作成（ローカル開発用）
- [ ] .dockerignoreの作成

### Google Cloud Run設定
- [ ] Cloud Run用の設定ファイル作成
- [ ] 本番環境用環境変数の整理
- [ ] デプロイスクリプトの作成

## フェーズ8: ドキュメント・仕上げ

- [ ] READMEの作成（セットアップ手順、使い方）
- [ ] 動作確認（ローカル環境）
- [ ] 動作確認（本番環境）
- [ ] パフォーマンス確認

---

## 進捗状況

| フェーズ | ステータス | 備考 |
|----------|------------|------|
| 1. プロジェクト初期設定 | 未着手 | |
| 2. データベース設定 | 未着手 | |
| 3. バックエンド実装 | 未着手 | |
| 4. フロントエンド実装 | 未着手 | |
| 5. 状態管理・UX改善 | 未着手 | |
| 6. テスト | 未着手 | |
| 7. デプロイ準備 | 未着手 | |
| 8. ドキュメント・仕上げ | 未着手 | |
